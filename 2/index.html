<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="管道材料计算 管道重量计算 管径计算 管道阻力计算 管道水力计算 物性查询 物质物理性质">
    <title>工程计算</title>
    <script>
        // var _hmt = _hmt || [];
        // (function() {
        //   var hm = document.createElement("script");
        //   hm.src = "https://hm.baidu.com/hm.js?d319312b017fe4df29c750d1c27439e0";
        //   var s = document.getElementsByTagName("script")[0]; 
        //   s.parentNode.insertBefore(hm, s);
        // })();
    </script>
    <script type="module" src="./Url.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div>
        <img src="./menu_bar.png" id="menubar">
        <ul id="menu">
            <li><a href="./"><b>工程计算</b></a>
        </ul>
        <ul>
            <li><a href="#" onclick="save()">保存</a></li>
        </ul>
    </div>
    <div id="page"></div>
    <a id="save-link" hidden></a>
    <script>
        document.getElementById("menubar").addEventListener("click", function () {
            let menu_ele = document.getElementById("menu");
            if (menu_ele.style.display == "none" || menu_ele.style.display == '') {
                menu_ele.style.display = "block";
            } else {
                menu_ele.style.display = "none";
            }
        });
    </script>
    <script>
        function downLoadLink(text) {
            var blob = new Blob([text], { type: "text/plain;charset=utf-8" ,endings:'native'});
            return URL.createObjectURL(blob);
        }
        function save() {
            let fileContent = new Object();
            fileContent.url = location.hash.slice(1) || '/';
            fileContent.inputs = new Array();
            let currentRow = (document.getElementsByClassName("row"))[0];
            do {
                let row = new Array();
                let inputs = currentRow.getElementsByTagName("input");
                for (let i = 0; i < inputs.length; i++) {
                    const val = inputs[i].value;
                    row.push(val);
                }
                let selects = currentRow.getElementsByTagName("select");
                for (let j = 0; j < selects.length; j++) {
                    const selectedIndex = selects[j].selectedIndex;
                    row.push(selectedIndex);
                }
                fileContent.inputs.push(row);
            } while (currentRow = currentRow.nextElementSibling);
    
            
            let link = document.getElementById("save-link");
            link.href = downLoadLink(JSON.stringify(fileContent));
            link.click();
        }
    </script>
</body>
</html>